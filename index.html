<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Body Fat Tracker</title>
	<meta name="theme-color" content="#0f1116" />
	<link rel="manifest" href="./manifest.json" />
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="./style.css" />
</head>
<body>
	<!-- Модаль авторизации -->
	<div class="modal-overlay" id="authModal">
		<div class="modal-content">
			<div class="modal-header">
				<h2 id="modalTitle">Кто ты?</h2>
				<button class="modal-close" id="closeAuthModal" aria-label="Закрыть">✕</button>
			</div>
			<div class="modal-body">
				<div id="loginForm">
					<div style="margin-bottom: 16px;">
						<label for="userSelect" class="label">Username</label>
						<input id="userSelect" type="text" placeholder="Введи свой username" />
					</div>
					<div style="margin-bottom: 20px;">
						<label for="passwordInput" class="label">Пароль</label>
						<input id="passwordInput" type="password" placeholder="Введи пароль" />
					</div>
					<p class="muted" id="authStatus" style="margin: 0 0 16px; font-size: 13px;">Твои данные защищены и хранятся на сервере.</p>
				</div>
				
				<div id="signupForm" style="display: none;">
					<div style="margin-bottom: 16px;">
						<label for="signupUsername" class="label">Придумай username</label>
						<input id="signupUsername" type="text" placeholder="Например, bohdan123" />
					</div>
					<div style="margin-bottom: 16px;">
						<label for="signupEmail" class="label">Email (опционально)</label>
						<input id="signupEmail" type="email" placeholder="Например, bohdan@example.com" />
					</div>
					<div style="margin-bottom: 20px;">
						<label for="signupPassword" class="label">Пароль</label>
						<input id="signupPassword" type="password" placeholder="Не менее 4 символов" />
					</div>
					<p class="muted" id="signupStatus" style="margin: 0 0 16px; font-size: 13px;"></p>
				</div>
				<div id="logoutForm" style="display: none;">
					<div id="accountInfo" style="text-align: center; margin-bottom: 20px;">
						<p style="font-size: 32px; margin: 0 0 12px;">✓</p>
						<p class="label" style="margin: 0; font-size: 16px;">Ты вошёл как</p>
						<p style="font-size: 24px; font-weight: 700; margin: 8px 0 16px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;" id="userDisplayName">User</p>
						<p class="muted" style="margin: 0; font-size: 13px;">Твои данные сохраняются безопасно на сервере</p>
					</div>
					
					<div id="changePasswordForm" style="display: none; text-align: left;">
						<h3 style="margin: 0 0 16px; font-size: 16px; font-weight: 600;">Смена пароля</h3>
						<div style="margin-bottom: 14px;">
							<label for="currentPassword" class="label">Текущий пароль</label>
							<input id="currentPassword" type="password" placeholder="Введи текущий пароль" />
						</div>
						<div style="margin-bottom: 14px;">
							<label for="newPassword" class="label">Новый пароль</label>
							<input id="newPassword" type="password" placeholder="Придумай новый пароль" />
						</div>
						<div style="margin-bottom: 16px;">
							<label for="confirmPassword" class="label">Подтверди пароль</label>
							<input id="confirmPassword" type="password" placeholder="Повтори новый пароль" />
						</div>
						<p class="muted" id="passwordChangeStatus" style="margin: 0 0 16px; font-size: 12px; text-align: center;"></p>
						<div style="display: flex; gap: 8px;">
							<button class="ghost" id="cancelChangePassword" style="flex: 1; padding: 12px; border: none; cursor: pointer; font-weight: 600;">Отмена</button>
							<button class="primary" id="saveNewPassword" style="flex: 1; padding: 12px; border: none; cursor: pointer; font-weight: 600;">Сохранить</button>
						</div>
					</div>
					
					<div id="accountActions" style="text-align: center;">
						<button class="ghost" id="toggleChangePassword" style="width: 100%; padding: 10px; border: none; margin-bottom: 12px; cursor: pointer; font-weight: 600; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 10px; color: #a5b4fc; transition: all 0.2s;">Сменить пароль</button>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button class="ghost" id="logoutBtn">Выйти</button>
				<button class="ghost" id="backToLogin" style="display: none;">Назад к входу</button>
				<button class="ghost" id="toggleSignup">Создать аккаунт</button>
				<button class="primary" id="loginBtn">Войти</button>
				<button class="primary" id="signupBtn" style="display: none;">Создать</button>
			</div>
		</div>
	</div>

	<div class="wrap">
		<header>
			<div>
				<div style="display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-bottom: 16px;">
					<p class="pill">Работает везде • Даже без интернета</p>
					<button class="pill-btn" id="openAuthModal">Войти</button>
					<span class="pill-badge" id="current-user-pill" style="display:none;"></span>
				</div>
				<h1 class="title">Проверь жир</h1>
				<p class="subtitle">Узнай процент жира по простой формуле. Отслеживай прогресс и смотри как меняется на графике.</p>
			</div>
			<div class="stat card" style="min-width: 200px;">
				<span class="label">Последний результат</span>
				<span class="value" id="last-result">—</span>
				<span class="muted" id="last-meta">Нет данных</span>
			</div>
		</header>

		<section class="grid">
			<div class="card" id="form-card">
				<div style="display:flex; justify-content: space-between; align-items:center; gap:10px; flex-wrap: wrap;">
					<div>
						<strong>Твой пол</strong>
						<p class="muted" style="margin:4px 0 0;">От этого зависит формула расчёта</p>
					</div>
					<div class="segmented" role="group" aria-label="Пол">
						<button id="maleBtn" class="active" type="button">Мужчина</button>
						<button id="femaleBtn" type="button">Женщина</button>
					</div>
				</div>

				<div class="inputs">
					<div>
						<label for="height">Рост (см)</label>
						<input id="height" type="number" inputmode="decimal" placeholder="Например, 178" />
					</div>
					<div>
						<label for="neck">Обхват шеи (см)</label>
						<input id="neck" type="number" inputmode="decimal" placeholder="Например, 38" />
					</div>
					<div>
						<label for="waist">Обхват талии (см)</label>
						<input id="waist" type="number" inputmode="decimal" placeholder="Например, 82" />
					</div>
					<div id="hip-wrap" style="display:none;">
						<label for="hip">Обхват бёдер (см)</label>
						<input id="hip" type="number" inputmode="decimal" placeholder="Только для женщин" />
					</div>
				</div>

				<div class="actions">
					<button class="primary" id="calcBtn" type="button">Рассчитать и сохранить</button>
					<button class="ghost" id="clearBtn" type="button">Очистить историю</button>
				</div>

				<div class="result" aria-live="polite">
					<div>
						<div class="muted">Получилось</div>
						<div class="number" id="current-result">—</div>
					</div>
					<div class="muted" id="current-note">Заполни данные выше</div>
				</div>
			</div>

			<div class="card">
				<div style="display:flex; justify-content: space-between; align-items:center;">
					<strong>Твой прогресс</strong>
					<span class="muted" id="history-count">0 записей</span>
				</div>
				<div class="history" id="history"></div>
			</div>
		</section>

		<section class="card">
			<div style="display:flex; justify-content: space-between; align-items:center; gap:10px; flex-wrap: wrap;">
				<div>
					<strong>Визуально видна траектория</strong>
					<p class="muted" style="margin:4px 0 0;">Каждая точка — твой расчёт, линия показывает тренд</p>
				</div>
			</div>
			<canvas id="chart" height="280"></canvas>
		</section>
	</div>

	<script src="./app.js"></script>
</body>
</html>
